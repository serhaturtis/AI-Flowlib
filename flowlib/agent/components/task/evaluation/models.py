"""Models for task completion evaluation."""

from typing import Literal, Optional

from pydantic import Field

from flowlib.resources.models.base import StrictBaseModel

# LLM-facing models

class LLMEvaluationResult(StrictBaseModel):
    """Evaluation result generated by LLM (semantic only)."""

    is_complete: bool = Field(..., description="Whether the task is complete")
    completion_confidence: str = Field(
        ...,
        description="Confidence level: low, medium, high"
    )
    reasoning: str = Field(..., description="Why this completion decision was made")
    next_action: Literal["done", "continue", "clarify"] = Field(
        ...,
        description="What should happen next: done (task complete), continue (execute more steps), clarify (need user input)"
    )
    clarification_question: Optional[str] = Field(
        default=None,
        description="Question to ask user if next_action is 'clarify'"
    )


# Full models

class EvaluationResult(StrictBaseModel):
    """Complete evaluation result with metadata."""

    is_complete: bool
    completion_confidence: float = Field(..., description="Confidence as decimal 0.0-1.0")
    reasoning: str
    next_action: Literal["done", "continue", "clarify"]
    clarification_question: Optional[str] = None

    # Programmatic fields
    evaluation_time_ms: float = Field(default=0.0, description="Time taken to evaluate")
    llm_calls_made: int = Field(default=1, description="Number of LLM calls")


class EvaluationInput(StrictBaseModel):
    """Input for task completion evaluation."""

    original_goal: str = Field(..., description="The original user request")
    plan_reasoning: str = Field(..., description="Reasoning from the plan")
    executed_steps: list[dict] = Field(..., description="Steps that were executed with results")
    expected_outcome: str = Field(..., description="What was expected from the plan")


class EvaluationOutput(StrictBaseModel):
    """Output from completion evaluation."""

    result: EvaluationResult = Field(..., description="The evaluation result")
    success: bool = Field(..., description="Whether evaluation succeeded")
    processing_time_ms: float = Field(default=0.0, description="Time taken to evaluate")
